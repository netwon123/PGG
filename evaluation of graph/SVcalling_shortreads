#get the different depht
#88_1_clean.fq.gz have 50x
~/software/seqtk-1.4/seqtk sample -s100 88_1_clean.fq.gz -f 0.1  > 88_1_clean.fq.gz_5x.fq
~/software/seqtk-1.4/seqtk sample -s100 88_1_clean.fq.gz -f 0.2  > 88_1_clean.fq.gz_10x.fq
~/software/seqtk-1.4/seqtk sample -s100 88_1_clean.fq.gz -f 0.4  > 88_1_clean.fq.gz_20x.fq
~/software/seqtk-1.4/seqtk sample -s100 88_1_clean.fq.gz -f 0.6  > 88_1_clean.fq.gz_30x.fq
~/software/seqtk-1.4/seqtk sample -s100 88_1_clean.fq.gz -f 0.8  > 88_1_clean.fq.gz_40x.fq



#alignment
bwa mem -t 16 -R '@RG\tID:id01\tPL:UNKNOWN\tSM:AW_15x'  /public/home/baoqi/PGG_netwon/final_merge/backone_genome/backone.fa ../88_1_clean.fq.gz_15x.fq.gz ../88_2_clean.fq.gz_15x.fq.gz | samtools view -@ 16 -bS | samtools sort -@ 16 -o 88_clean_15x.bam

ls *bam | while read id;
do
gatk --java-options "-Xms32G -Xmx120G -DGATK_STACKTRACE_ON_USER_EXCEPTION=true" MarkDuplicates -I $id -O ${id}_rmM.bam --REMOVE_SEQUENCING_DUPLICATES true -M ${id}.log
done

ls *_rmM.bam | while read id;
do
samtools index -@ 8 ${id}
done

#call snp
ls *_rmM.bam | while read id;
do
gatk --java-options "-Xms32G -Xmx120G -DGATK_STACKTRACE_ON_USER_EXCEPTION=true" HaplotypeCaller -R ~/PGG_netwon/final_merge/backone_genome/backone.fa -I $id -O ${id}.vcf.gz
done

ls *gz | while read id;
do
bcftools norm --threads 16 -m -both $id -Oz -o ${id}.split.vcf.gz
tabix -f ${id}.split.vcf.gz
done


#delly
delly call -n  -g ~/PGG_netwon/final_merge/backone_genome/backone.fa $id -o ${id}.delly.bcf

#whamg
/public/home/baoqi/software/wham/bin/whamg -x 6 -a ~/PGG_netwon/final_merge/backone_genome/backone.fa -f $id > ${id}.whamg.bcf

#lumpy
ls *rmM.bam | while read id;
do
~/software/lumpy-sv-0.3.1/scripts/extractSplitReads_BwaMemic/home/baoqi/software/wham/bin/whamg -x 6 -a ~/PGG_netwon/final_merge/backone_genome/backone.fa -f $id > ${id}.whamg.bcf
samtools view -b -F 1294 $id > ${id}.discordants.unsorted.bam
samtools view -h $id \
    | ~/software/lumpy-sv-0.3.1/scripts/extractSplitReads_BwaMem  -i stdin \
    | samtools view -Sb - \
    > ${id}.splitters.unsorted.bam
done


ls *.discordants.unsorted.bam | while read id;
do
samtools sort -@ 4 $id -o ${id}.discordants.sort.bam
done

ls *splitters.unsorted.bam | while read id;
do
samtools sort -@ 4  $id -o ${id}.sample.splitters.sort.bam
done


#manta
python /public/home/baoqi/software/manta-1.6.0.centos6_x86_64/bin/configManta.py --bam 01_10x.bam_rmM.bam \
--referenceFasta ~/PGG_netwon/final_merge/backone_genome/backone.fa --runDir manta_01_10x
python manta_01_10x/runWorkflow.py  -m local -j 8

#compared two vcf 
ls *indel50.vcf | while read id; do bcftools view --exclude 'GT="0/0" || GT="0" || GT="."' $id | bcftools norm -f ~/PGG_netwon/final_merge/backone_genome/backone.fa | bcftools sort > ${id}.noref.vcf;done
ls *noref.vcf | while read id;do bgzip -@ 8 $id;done
ls *gz | while read id; do tabix -f $id;done
ls *.noref.vcf.gz | while read id; do truvari bench -b /public/home/baoqi/SVanalysis/eval/truth_set/PTR_merge_5tools.vcf.filted.vcf.indel.vcf.2.vcf.sort.vcf.gz -c $id -f ~/PGG_netwon/final_merge/backone_genome/backone.fa  --dup-to-ins -p 0 --passonly -s 50 -r 1000 -o ${id}_new;done
